<script>
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    const url = "https://api.thingspeak.com/channels/3088143/feeds.json?api_key=3E5SCJNQ6QWIDDL4&results=2"; // Replace with your actual URL

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const feeds = data.feeds;

        // Prepare data for Google Charts
        const chartData = [['Time', 'Temperature']];
        feeds.forEach(feed => {
          const time = new Date(feed.created_at);
          const temp = parseFloat(feed.field1); // Assuming field1 is temperature
          if (!isNaN(temp)) {
            chartData.push([time, temp]);
          }
        });

        const dataTable = google.visualization.arrayToDataTable(chartData);

        const options = {
          title: 'Temperature Over Time',
          curveType: 'function',
          legend: { position: 'bottom' },
          hAxis: { title: 'Time' },
          vAxis: { title: 'Temperature (Â°C)' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(dataTable, options);
      })
      .catch(error => {
        console.error("Error fetching ThingSpeak data:", error);
        document.getElementById('chart_div').innerText = "Failed to load chart.";
      });
  }
</script>